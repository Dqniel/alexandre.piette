$(function() {
      $("a:not(#shareBtn, .btn_start, .btn_validate, .btn_mail)").on('click', function (event) {
        event.preventDefault();
        window.location = $(this).attr("href");
    });

 /* PREVENT SCROLL ON TABLET */
 $('#swipe').bind("touchmove",function(event){
     event.preventDefault();
 });


 /* SCROLL THUMBNAILS */
 $('.container_global_thumbnail').on('mousewheel', function(event, delta) {
   //alert('ok')
   event.preventDefault();
   this.scrollLeft -= (delta * 20);
   return false;
 });


 /* SWIPE ADMIN */
 $("#swipe").dragend({
   afterInitialize: function() {
     this.container.style.visibility = "visible";
     $('.parameters').remove('hidden');
   }
 })


 /* ANIM INPUT PSEUDO + MAIL */
 myInput = document.querySelectorAll("#pseudo, #mail");
$('#pseudo, #mail').on('focusout', function() {
    var empty = $(this).parent().find("input").filter(function() {
        return this.value === "";
    });
    if(empty.length) {
        $('#pseudo').css({
       'min-width': '120px',
       'transition': '0.3s'
     });

    $('#mail').css({
       'min-width': '250px',
       'transition': '0.3s'
     });
    }
});
for (element of myInput) {
  element.addEventListener("keyup", function() {
    this.size = this.value.length+2;
    //alert(this.value.length);
  });
}




  $( ".section-right" ).tabs();

  $('.link_container_tab').on('click', function(){
    $('.link_container_tab').removeClass('active-tabs');
    $(this).addClass('active-tabs');
  })

  $('.box_item').on('click', function(){
    $(this).addClass('selected');
  })

  // PALETTE COULEUR

  $( ".container_btn-palette-test" ).tabs();
  $( ".container_btn-palette-test" ).hide();
  $('.container').click(function(){
    $(".container_btn-palette-test").toggle();
  });

  $("#tabs-1 li").click(function(){
    color = $(this).attr("data-color");
    $(".drag-zone").attr("data-color",color);
    $(".btn_palette-blue").attr("data-color", color);
     $(".fill a").attr("data-color", color);
  })

  $("#tabs-2 li").click(function(){
    outline = $(this).attr("data-outline");
    fill= $(this).attr("data-fill");
    $(".drag-zone_logo-badge").attr("data-fill", fill);
    $(".btn_palette-blue").attr("data-outline", outline);
    $(".mini_logo-palette").attr("data-fill", fill);
    $("#cepegra").attr("data-fill", fill);
    $("#text-badge").attr("data-fill", fill);
    $(".drag").attr("data-fill", fill);
  })

  $('#tabs-1').on("click", ".color-fill", function(){
    var itemClass = $(this).attr("data-color");
    $('#tabs-1, .color-fill').removeClass('color-selected');
    $(this).add('.color-fill.'+itemClass+'').addClass('color-selected');
  });

    $('#tabs-2').on("click", ".color-outline", function(){
    var itemClass = $(this).attr("data-outline");
    $('#tabs-1, .color-outline').removeClass('color-selected');
    $(this).add('.color-outline.'+itemClass+'').addClass('color-selected');
  });



  /* SCROLL THUMBNAILS */
  $('.container_global_thumbnail').on('mousewheel', function(event, delta) {
    //alert('ok')
    event.preventDefault();
    this.scrollLeft -= (delta * 20);
    return false;
  });




  /* PUT SVG IN PRINT AND SHARe */
    var myBadge = JSON.parse(localStorage.getItem('myBadge'));
    $(".badge__finished").html(myBadge);



// Print

$('.btn_print').click(function(){
      print();

});

var colorBgdBadge = function(){
  var bgdBadge = $('#bcgGrad').css('fill');

  $('.badge__finished_print').css("background-color",bgdBadge);
};



    var beforePrint = function() {
        $('.badge__finished_print').removeClass('hidden');
        colorBgdBadge();
    };

    var afterPrint = function() {
        $('.badge__finished_print').addClass('hidden');
    };

    if (window.matchMedia) {
        var mediaQueryList = window.matchMedia('print');
        mediaQueryList.addListener(function(mql) {
            if (mql.matches) {
                beforePrint();
            } else {
                afterPrint();
            }
        });
    }

    window.onbeforeprint = beforePrint;
    window.onafterprint = afterPrint;



  //@prepros-append components/_photo.js
  //@prepros-append components/_print-and-share.js
  //@prepros-append components/_creationBadge.js
  //@prepros-append components/_svgToImg.js
  //@prepros-append components/_sendMail.js
});

/* PHOTO BUTTON + PARAMETERS */
$('.btn_photo').on('click', function(){
  if($(this).hasClass('btn_photo__take')) {
    $(this).removeClass('btn_photo__take');
    $(this).addClass('btn_photo__editor');
  }
  else {
    $('.container_photo-parameters').removeClass('hidden');
  }
});

$('.btn_photo-parameters__del').on('click', function(){
  $(this).parent().addClass('hidden');
  $('.btn_photo').removeClass('btn_photo__editor').addClass('btn_photo__take')
});

$('.btn-storage').on('click', function(){
    $('.header_print-and-share, .container_print-and-share').addClass('blur');
    $('.container_print-and-share__fade-in').css("display", "flex");
    $('container_print-and-share__fade-in').addClass('bop');
});

$('.print').on('click', function(){
    $('.li_pop_1').css("display", "none");
    $('.li_pop_2').css("display", "block");
    $('.li_pop_3').css("display", "block");
    $(".text_pop_action").replaceWith("<p class='text_pop text_pop_action'>Ton badge sera imprimé d'ici quelques minutes</p>");
    $(".text_pop_option").replaceWith("<p class='text_pop text_pop_option'>N'oublie pas de partager ton design sur facebook</p>");
});

$('.mail').on('click', function(){
    $('.li_pop_1').css("display", "block");
    $('.li_pop_2').css("display", "none");
    $('.li_pop_3').css("display", "block");
    $(".text_pop_action").replaceWith("<p class='text_pop text_pop_action'>Ton avatar a bien été envoyé!</p>");
    $(".text_pop_option").replaceWith("<p class='text_pop text_pop_option'>N'oublie pas de partager ton design sur facebook</p>");
});

$('.face').on('click', function(){
    $('.li_pop_1').css("display", "block");
    $('.li_pop_2').css("display", "block");
    $('.li_pop_3').css("display", "none");
    $(".text_pop_action").replaceWith("<p class='text_pop text_pop_action'>Ton avatar a bien été publié sur facebook!</p>");
    $(".text_pop_option").replaceWith("<p class='text_pop text_pop_option'>N'oublie pas de te l'envoyer par email</p>");
});

$('.one').on('click', function(){
    $('hr').css("left", "28px");
    $('hr').css("width", "8.1%");
});
$('.two').on('click', function(){
    $('hr').css("left", "125px");
    $('hr').css("width", "14.5%");
});
$('.three').on('click', function(){
    $('hr').css("left", "254px");
    $('hr').css("width", "14.1%");
});
$('.four').on('click', function(){
    $('hr').css("left", "381px");
    $('hr').css("width", "20%");
});

$('#shareBtn').on('click', function(e){
    var elementLS = window.localStorage.getItem("filename");
    e.preventDefault();
    alert('facebook');
    //FB.init();
  FB.ui({
    method: 'share',
    //display: 'iframe',
    mobile_iframe: true,
    //app_id: 184484190795,
    href: 'https://killer-cepegra.xyz/badges/'+elementLS+'.png',
  }, function(response){
      //return false;
       $('.li_pop_1').css("display", "block");
    $('.li_pop_2').css("display", "block");
    $('.li_pop_3').css("display", "none");
    $(".text_pop_action").replaceWith("<p class='text_pop text_pop_action'>Ton avatar a bien été publié sur facebook!</p>");
    $(".text_pop_option").replaceWith("<p class='text_pop text_pop_option'>N'oublie pas de te l'envoyer par email</p>");
  });


});


// SHARE FACEBOOK
  window.fbAsyncInit = function() {
    FB.init({
      appId            : '1948586515423473',
      autoLogAppEvents : true,
      xfbml            : true,
      version          : 'v2.10'
    });
    FB.AppEvents.logPageView();
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));

/**** DRAG AND DROP ****/

// Click sur les items des tabs
$('.box_item').on('click', function(){
  var itemClass = $(this).attr("data-item");
  $('.box_item').removeClass('selected');
  $('.box_thumbnail').removeClass('selected');
  $('.delete_cross').addClass('hidden');
  $(this).children('.delete_cross').removeClass('hidden');

  if(!$(this).hasClass('active')){
    // Cloner le svg et lui ajouter un data item
    var cloneSvg = $(this).children('svg').clone();
    // Récupération des datas
    var svgWidth = cloneSvg.attr('data-width');
    var svgX = cloneSvg.attr('data-x');
    var svgY = cloneSvg.attr('data-y');

    cloneSvg = cloneSvg.data("item", itemClass);

    // Svg du thumbnail
    var thumbnailSvg = $('<div>').append($(cloneSvg)).html();

    // Ajouter la classe drag + les attributs au Svg du badge
    var badgeSvg = cloneSvg.addClass('drag '+itemClass+'');
    badgeSvg = badgeSvg.attr('width', svgWidth);
    badgeSvg = badgeSvg.attr('x', svgX);
    badgeSvg = badgeSvg.attr('y', svgY);
    badgeSvg = badgeSvg.attr('fill', $('.drag-zone_logo-badge').css('fill'))
    badgeSvg = badgeSvg.draggable().on('drag', function(event, ui){
      // update coordinates manually, since top/left style props don't work on SVG
      event.target.setAttribute('x', ui.position.left - addSvg.data('osX') +  parseFloat(svgX));
      event.target.setAttribute('y', ui.position.top - addSvg.data('osY') + parseFloat(svgY));
    });

    // Si il y a déjà un élément devant la light, on le met derrière
    if($('.light-badge').next('.drag').length > 0){
      $('.light-badge').next('.drag').attr('stroke-width', '0px');
      $('.light-badge').next('.drag').insertBefore('.light-badge');
    }

    // On insert le nouvel élément après la light
    var addSvg = badgeSvg.insertAfter('.light-badge');

    addSvg.data('osX', addSvg.offset().left);
    addSvg.data('osY', addSvg.offset().top);
    addSvgX = 315 * parseFloat(addSvg.attr('x')) / 100;


    $('<li class="box_thumbnail selected" data-item="'+itemClass+'">'+thumbnailSvg+'</li>').appendTo('.container_items_thumbnail');

    $(this).addClass('active selected');
    $('.btn_trash').removeAttr('hidden');
  }
  else{
    $(this).add('.box_thumbnail[data-item='+itemClass+']').addClass('selected');
    //Scroll to element
    $('.container_global_thumbnail').scrollTo($(".box_thumbnail[data-item="+itemClass+"]"), 500, {axis:'x'});

    highLighter(itemClass);
  }
})

// Zone de drop - trash à l'extérieur du badge
$('main').droppable({
  accept : ".drag",
  hoverClass : "active-trash",
  drop: function(event, ui){
    var dragClass = $(ui.draggable).data("item");
    $('.box_thumbnail.'+dragClass+'').remove();
    $(ui.draggable).remove();
    $('[data-item='+dragClass+']').removeClass('active selected');
    $('[data-item='+dragClass+'] .delete_cross').addClass('hidden');
    $('.box_thumbnail[data-item='+dragClass+']').remove();

    hiddenTrash();
    autoSelect();
  }
})

// Zone de drop - intérieur du badge
$('.badge-svg').droppable({
  accept: ".drag",
  greedy: true
})


// Click sur le reset - activation shake + popup
$( ".btn_reset" ).on('click', function(){
  $(".container_items_thumbnail").children().addClass("shake");
  $(".background-popup, .popup").removeAttr("hidden");
});

// Réponse OUI au popup
$( ".answer-yes" ).on('click', function(){
  $(".container_items_thumbnail").children().remove();
  $(".box_item").removeClass('active selected');
  $('.drag').remove();
  $(".background-popup, .popup").attr("hidden", true);
  $('.delete_cross:not(.hidden)').addClass('hidden');

  hiddenTrash();
});

// Réponse NON au popup
$( ".answer-no" ).click(function(){
  $(".background-popup, .popup").attr("hidden", true);
  $(".container_items_thumbnail").children().removeClass("shake");
});

// Click sur les thumbnails
$('.container_items_thumbnail').on("click", ".box_thumbnail", function(){
  var itemClass = $(this).attr("data-item");
  $('.box_thumbnail, .box_item').removeClass('selected');
  $('[data-item='+itemClass+']').addClass('selected');
  $('.delete_cross').addClass('hidden');
  $('.box_item[data-item='+itemClass+']').children('.delete_cross').removeClass('hidden');
  $('.box_item[data-item='+itemClass+']');

  var ariaTrue = "true";
  var ariaFalse = "false";
  $('.container_items').attr('aria-hidden', 'true').css('display', 'none');
  $('.box_item[data-item='+itemClass+']').parent('.container_items').attr('aria-hidden', 'false').css('display', 'flex');
  // $('.link_container_tab').removeClass('.active-tabs');
  // $('.box_item[data-category="eye"]').parent('.link_container_tab').attr('.[data-category="eye"]').addClass('active-tabs');


  highLighter(itemClass);
});

// Click sur la POUBELLE + CROIX pour jeter les éléments sélectionnés
$('.btn_trash, .delete_cross').on('click', function(event){
  event.stopPropagation(dataItem);
  var dataItem = $('.box_thumbnail.selected').attr("data-item");
  $('.box_item.selected').removeClass('active selected');
  $('.box_thumbnail.selected').remove();
  $('.delete_cross:not(.hidden)').addClass('hidden');

  $(".drag").each(function(){
    if($(this).data('item') == dataItem) {
      $(this).remove();
    }
  })

  hiddenTrash();
  autoSelect();
});

//   $('.box_thumbnail').on('click', function(){
//     //  alert('hey');
//     $('hr').css("left", "28px");
//     $('hr').css("width", "8.1%");
// });


/**** FUNCTIONS ****/

// Mettre en avant l'item manipulable
function highLighter(itemClass){
  $('.light-badge').next('.drag').insertBefore('.light-badge');
  $('.drag.'+itemClass+'').insertAfter('.light-badge');
  // $('.drag.'+itemClass+'').css("fill", "red");
}

// Disparition de la poubelle quand il n'y a plus d'éléments
function hiddenTrash(){
  if($('.box_thumbnail').length == 0){
    $('.btn_trash').attr('hidden', true);
  }
}

// Auto séléction
function autoSelect(){
  if($('.container_items_thumbnail').find('li').length > 0){
    var lastLi = $('.box_thumbnail').last();
    var lastLiData = lastLi.attr('data-item');
    var theBox = $('.box_item[data-item='+lastLiData+']');
    theBox.addClass('selected');
    theBox.find('.delete_cross').removeClass('hidden');

    lastLi.addClass('selected');
    highLighter(lastLiData);
  }
}

/* SVG TO IMAGE */
// Click sur le bouton valider
$('.btn_validate').on('click', function(e){
  e.preventDefault();

  // Couleur du fond + couleur outline
  var bcgColor = $('#bcgGrad').css('fill');
  $("#bcgGrad").attr('fill', bcgColor);
  var outlineColor = $('.drag-zone_logo-badge').css('fill');
  $('.drag-zone_logo-badge, .drag').attr('fill', outlineColor);


/* SVG DANS LE LOCALSTORAGE POUR IMPRESSION */
  // Replacer l'élément mis en avant derrière la light
  $('.light-badge').next('.drag').insertBefore('.light-badge');
  // Selectionner le svg conteneur
  var svgDiv = $(".badge-svg").clone();
  var svg = svgDiv[0].outerHTML;

  localStorage.setItem('myBadge', JSON.stringify(svg));

/* SVG TO IMAGE POUR LE SHARE */
  // Supprimer la light
  svgDiv.find('linearGradient, .light-badge').remove();

  //Récupérer le texte du pseudo
  var myPseudo = $('#myPath').text()

  //Supprimer le textPath + Cepegra
  svgDiv.find('#myPath, #cepegra').remove();

  //Afficher le text pseudo caché
  svgDiv.find('.sharePseudoText').text(myPseudo).attr('fill', outlineColor).removeAttr('hidden');
  svgDiv.find('.hiddenCepegra').removeAttr('hidden');
  svgDiv.find(".circle-txt").attr('fill', outlineColor);

  svg = svgDiv[0].outerHTML;

  // Selectionner le canvas caché
  var canvas = document.getElementById('hiddenCanvas');

  // Utilisation de canvg
  canvg(canvas, svg)

  // Conversion de l'image en data...
  var theImage = canvas.toDataURL('image/png');

  // REQUETE AJAX
  $.ajax({
    type: 'POST',
    url: "../php/svgToImg.php",
    data: {
      'dataUrl': theImage,
    },
    success: function(data){
      localStorage.setItem('fileName', data);
      location.href='print_and_share.html';
    }
  })
});

/* SEND EMAIL */
$(".btn_mail").on('click', function(e){
  e.preventDefault();

  // REQUETE AJAX
   $.ajax({
    type: 'POST',
    url: "../php/sendMail.php",
    data: {
      'pseudo': localStorage.getItem('pseudo'),
      'email': localStorage.getItem('email'),
      'fileName': localStorage.getItem('fileName')
    },
    success: function(data){
      console.log("Mail envoyé");
    }
  })
})


//# sourceMappingURL=scripts.min.js.map